name: Tender Collector
on:
  schedule:
    - cron: "10 5 * * *"   # daily 05:10 UTC
  workflow_dispatch: {}

jobs:
  collect:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - uses: actions/setup-python@v5
        with:
          python-version: "3.11"

      - name: Install dependencies
        run: |
          pip install --upgrade pip
          pip install feedparser requests beautifulsoup4 pandas gspread google-auth openai

      - name: Run tender collector
        env:
          OPENAI_API_KEY: ${{ secrets.OPENAI_API_KEY }}
          OPENAI_MODEL: gpt-4o-mini
          RSS_FILE: feeds_rss.txt
          HOSPITAL_FILE: hospitals.txt
          CONF_THRESHOLD: "0.3"          # less strict â†’ higher recall for testing
          DEBUG: "1"                     # print sample titles when no hits
          GOOGLE_SERVICE_ACCOUNT_JSON: ${{ secrets.GOOGLE_CREDENTIALS_TENDERS }}
          GOOGLE_SHEET_ID: ${{ secrets.GOOGLE_SHEET_ID }}
          GOOGLE_SHEET_TAB: Sheet1
        run: python run_agent.py
